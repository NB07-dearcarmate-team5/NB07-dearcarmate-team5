// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

//사원정보
model User {
  id                Int      @id @default(autoincrement())
  email             String   @unique
  password          String
  name              String
  imageUrl          String?
  employeeNumber    String   @unique
  phoneNumber       String   // 연락처 (010 누락 방지를 위해 String)
  isAdmin           Boolean  @default(false) // 어드민 확인용, 기본값 false

  companyId         Int    
  company           Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  customers         Customer[]
  contracts         Contract[]

  created_at        DateTime @default(now())
  updated_at        DateTime @default(now())
}

//회사정보
model Company {
  id           Int  @id @default(autoincrement())
  companyName  String
  companyCode  String @unique //회사 코드
  users        User[]
  cars         Car[]
  customers    Customer[]
  created_at   DateTime @default(now())
  updated_at   DateTime @default(now())
}

//차량정보
model Car {
  id                  Int      @id @default(autoincrement())
  carNumber           String   @unique // 차량 번호
  manufacturer        String   // 제조사
  model               String   // 차종/모델명
  type                String   // 세단, 경차, SUV 등
  manufacturingYear   Int      // 제조연도
  mileage             Int      // 주행거리
  price               BigInt   // 가격(원)
  accidentCount       Int      @default(0) // 사고횟수
  status              String   @default("possession") // possession | contractProceeding | contractCompleted
  explanation         String?  @db.Text // 차량 설명
  accidentDetails     String?  @db.Text // 사고상세내역
  // 관계 설정: 차량은 특정 회사에 귀속됨
  companyId     Int
  company       Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  contracts     Contract[]
  created_at    DateTime @default(now())
  updated_at    DateTime @updatedAt
}

//고객정보
model Customer {
  id             Int      @id @default(autoincrement())
  name           String   // 고객명
  gender         String   // male | female
  phoneNumber    String   // 연락처 (010 누락 방지를 위해 String)
  email          String   
  ageGroup       String?  // 연령대 (선택)
  region         String?  // 지역 (선택)
  memo           String?  @db.Text // 메모
  // 관계 설정: 누가(User), 어느 회사(Company)의 고객인지 관리
  userId         Int      // 등록한 사원 ID
  user           User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  companyId      Int      // 소속 회사 ID
  company        Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  contracts      Contract[]
  created_at     DateTime @default(now())
  updated_at     DateTime @updatedAt
}

//계약정보
model Contract {
  id            Int      @id @default(autoincrement())
  // 관계 설정
  carId           Int      // 선택한 차량
  car             Car      @relation(fields: [carId], references: [id], onDelete: Cascade)
  customerId      Int      // 선택한 고객
  customer        Customer @relation(fields: [customerId], references: [id], onDelete: Cascade)
  userId          Int      // 담당자 (User)
  user            User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  contractPrice   BigInt   // 명세서의 contractPrice (큰 금액 대비 BigInt)
  resolutionDate  DateTime? // 명세서의 resolutionDate (계약 결정일)
  status          String   // 명세서의 status
  alarms          Alarm[] // 미팅 일정들 (최대 3개)
  created_at      DateTime @default(now())
  updated_at      DateTime @updatedAt
}

model Alarm {
  id              Int      @id @default(autoincrement())
  // 어느 계약에 속한 일정인지
  contractId      Int
  contract        Contract @relation(fields: [contractId], references: [id], onDelete: Cascade)
  // 미팅 정보
  date            DateTime // 선택한 날짜와 시간
  // 알람 설정 (체크박스)
  isMorningAlarm  Boolean  @default(false) // 당일 오전 9시 알림
  isYesterdayAlarm Boolean  @default(false) // 작일 오전 9시 알림
  created_at      DateTime @default(now())
  updated_at      DateTime @updatedAt
}